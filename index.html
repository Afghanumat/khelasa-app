<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ø®Ù„Ø§ØµÙ‡ Ù¾Ù„Ø§Ø³ | Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯Ø±Ù†</title>
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/adhan@4.0.0/App/Adhan.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment-jalaali@0.9.2/build/moment-jalaali.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;300;500;700;900&display=swap');
        
        /* --- BASE STYLES --- */
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #0f172a;
            color: white;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            /* Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ù…ØªØ­Ø±Ú© Ùˆ Ø¬Ø°Ø§Ø¨ */
            background: radial-gradient(circle at 50% 0%, #1e3a8a 0%, #0f172a 60%);
            background-attachment: fixed;
            min-height: 100vh;
        }

        /* --- GLASSMORPHISM CARD --- */
        .glass-panel {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            border-radius: 24px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .glass-panel:active { transform: scale(0.96); }

        /* --- WIDGET GRID --- */
        .grid-layout {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            padding: 16px;
            padding-bottom: 100px;
            max-width: 600px;
            margin: 0 auto;
        }

        .widget-item {
            position: relative;
            height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 16px;
            overflow: hidden;
        }

        /* --- EXPANDED STATE (MODAL LIKE) --- */
        .widget-item.expanded {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) !important;
            width: 90%;
            max-width: 400px;
            height: auto;
            max-height: 80vh;
            z-index: 100;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            grid-column: auto;
            grid-row: auto;
            overflow-y: auto;
        }

        /* --- CONTENT VISIBILITY --- */
        .w-detail {
            display: none;
            opacity: 0;
            margin-top: 20px;
            animation: fadeIn 0.4s forwards;
        }
        .widget-item.expanded .w-detail { display: block; }
        .widget-item.expanded .w-summary { display: none; }
        .widget-item.expanded .w-icon { transform: scale(0.8); opacity: 0.5; }

        @keyframes fadeIn { to { opacity: 1; } }

        /* --- SKELETON LOADING --- */
        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 6px;
            color: transparent !important;
        }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        /* --- CUSTOM SCROLL --- */
        ::-webkit-scrollbar { width: 0px; }
    </style>
</head>
<body>

    <div id="overlay" class="fixed inset-0 bg-black/60 z-40 hidden backdrop-blur-sm transition-opacity" onclick="closeAll()"></div>

    <header class="sticky top-0 z-30 px-6 py-4 flex justify-between items-center bg-transparent backdrop-blur-md">
        <div>
            <h1 class="text-2xl font-black tracking-tighter text-white">Ø®Ù„Ø§ØµÙ‡ <span class="text-blue-400">.</span></h1>
            <p class="text-xs text-blue-200/70 mt-1" id="headerDate">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p>
        </div>
        <div class="glass-panel w-10 h-10 flex items-center justify-center cursor-pointer hover:bg-white/10">
            <i class="fas fa-search text-white"></i>
        </div>
    </header>

    <div id="grid" class="grid-layout">

        <div class="glass-panel widget-item group relative overflow-hidden" onclick="expand(this)">
            <div class="absolute -top-10 -right-10 w-24 h-24 bg-green-500/20 rounded-full blur-2xl group-hover:bg-green-500/30 transition"></div>
            
            <div class="flex justify-between items-start w-summary">
                <div class="w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center text-green-400 w-icon"><i class="fas fa-dollar-sign"></i></div>
                <span class="text-[10px] bg-green-500/20 text-green-300 px-2 py-1 rounded-full">Ø²Ù†Ø¯Ù‡</span>
            </div>
            
            <div class="mt-auto w-summary">
                <p class="text-xs text-gray-400 mb-1">Ø¯Ø§Ù„Ø± Ø¨Ù‡ Ø§ÙØºØ§Ù†ÛŒ</p>
                <h2 class="text-3xl font-black text-white tracking-wide" id="usdPrice"><span class="skeleton">00.00</span></h2>
            </div>

            <div class="w-detail h-full">
                <div class="flex justify-between items-center mb-6 border-b border-white/10 pb-4">
                    <h3 class="text-lg font-bold">Ù†Ø±Ø® Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ø§Ø±Ø²</h3>
                    <button class="text-gray-400"><i class="fas fa-times"></i></button>
                </div>
                
                <div class="space-y-3" id="rateList">
                    </div>

                <div class="mt-6 pt-4 border-t border-white/10">
                    <label class="text-xs text-gray-400 block mb-2">Ù…Ø­Ø§Ø³Ø¨Ù‡â€ŒÚ¯Ø± Ø³Ø±ÛŒØ¹ (USD Ø¨Ù‡ AFN)</label>
                    <div class="flex gap-2">
                        <input type="number" id="convInput" class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-center text-white outline-none focus:border-green-500 transition" placeholder="Ù…Ø¨Ù„Øº Ø¯Ø§Ù„Ø±" oninput="convert()">
                        <div class="w-full bg-green-600/20 border border-green-500/30 rounded-xl p-3 text-center text-green-300 font-bold" id="convRes">0</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="glass-panel widget-item group relative overflow-hidden" onclick="expand(this)">
            <div class="absolute -top-10 -left-10 w-24 h-24 bg-indigo-500/20 rounded-full blur-2xl group-hover:bg-indigo-500/30 transition"></div>
            
            <div class="flex justify-between items-start w-summary">
                <div class="w-10 h-10 rounded-full bg-indigo-500/20 flex items-center justify-center text-indigo-400 w-icon"><i class="fas fa-mosque"></i></div>
                <span class="text-[10px] text-gray-400">Ú©Ø§Ø¨Ù„</span>
            </div>
            
            <div class="mt-auto w-summary">
                <p class="text-xs text-gray-400 mb-1">Ù†Ù…Ø§Ø² Ø¨Ø¹Ø¯ÛŒ: <span id="nextPName">...</span></p>
                <h2 class="text-3xl font-black text-white tracking-wide" id="nextPTime"><span class="skeleton">--:--</span></h2>
            </div>

            <div class="w-detail">
                <div class="flex justify-between items-center mb-4 border-b border-white/10 pb-4">
                    <h3 class="text-lg font-bold text-indigo-300">Ø§ÙˆÙ‚Ø§Øª Ø´Ø±Ø¹ÛŒ Ø§Ù…Ø±ÙˆØ²</h3>
                    <i class="fas fa-times text-gray-400"></i>
                </div>
                <ul class="space-y-3" id="prayerFullList"></ul>
                <div class="mt-4 p-3 bg-indigo-500/10 rounded-xl text-center">
                    <p class="text-xs text-indigo-200" id="hijriDate">...</p>
                </div>
            </div>
        </div>

        <div class="glass-panel widget-item group" onclick="expand(this)">
            <div class="flex justify-between items-start w-summary">
                <div class="w-10 h-10 rounded-full bg-sky-500/20 flex items-center justify-center text-sky-400 w-icon"><i class="fas fa-cloud"></i></div>
            </div>
            <div class="mt-auto w-summary flex justify-between items-end">
                <div>
                    <p class="text-xs text-gray-400 mb-1" id="wDesc">ØµØ§Ù</p>
                    <h2 class="text-3xl font-black text-white" id="wTemp"><span class="skeleton">--Â°</span></h2>
                </div>
                <i class="fas fa-sun text-yellow-400 text-3xl animate-pulse"></i>
            </div>
            <div class="w-detail">
                <h3 class="text-lg font-bold mb-4 text-sky-300">Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§</h3>
                <div class="grid grid-cols-2 gap-4 text-center mb-6">
                    <div class="bg-white/5 p-3 rounded-xl">
                        <i class="fas fa-wind text-gray-400 mb-1"></i>
                        <div class="font-bold" id="wWind">--</div>
                    </div>
                    <div class="bg-white/5 p-3 rounded-xl">
                        <i class="fas fa-tint text-gray-400 mb-1"></i>
                        <div class="font-bold" id="wHum">--</div>
                    </div>
                </div>
                <div class="space-y-2" id="wForecast"></div>
            </div>
        </div>

        <div class="glass-panel widget-item group border-0" style="background: linear-gradient(145deg, #6366f1, #3b82f6);" onclick="expand(this)">
            <div class="flex justify-between items-start w-summary">
                <div class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center text-white"><i class="fas fa-book-open text-xs"></i></div>
            </div>
            <div class="mt-auto w-summary">
                <p class="text-[10px] text-blue-100 mb-1">Ú©Ù„Ø§Ù… Ù†ÙˆØ±</p>
                <p class="text-sm font-bold text-white line-clamp-2 leading-relaxed">Ù‚Ø§Ù„ Ø±Ø³ÙˆÙ„ Ø§Ù„Ù„Ù‡ (Øµ): Ù‡Ø± Ú©Ù‡ Ø³Ú©ÙˆØª Ú©Ù†Ø¯ Ù†Ø¬Ø§Øª ÛŒØ§Ø¨Ø¯.</p>
            </div>
            <div class="w-detail text-center">
                <h3 class="text-lg font-bold text-white mb-6">Ø­Ø¯ÛŒØ« Ø±ÙˆØ²</h3>
                <p class="font-[Scheherazade] text-2xl mb-4 leading-loose" id="hAr">...</p>
                <p class="text-sm bg-white/20 p-4 rounded-xl leading-relaxed" id="hFa">...</p>
            </div>
        </div>

        <div class="glass-panel widget-item col-span-2 h-auto min-h-[140px]" onclick="expand(this)">
            <div class="flex justify-between items-center w-summary mb-2">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center text-red-400"><i class="fas fa-newspaper"></i></div>
                    <span class="text-sm font-bold">Ø³Ø±Ø®Ø· Ø®Ø¨Ø±Ù‡Ø§</span>
                </div>
                <span class="text-[10px] bg-red-500 text-white px-2 py-0.5 rounded">ÙÙˆØ±ÛŒ</span>
            </div>
            <div class="w-summary">
                <p class="text-sm text-gray-300 truncate" id="newsTitle">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø®Ø¨Ø§Ø±...</p>
                <p class="text-xs text-gray-500 mt-1" id="newsTime">Ù„Ø­Ø¸Ø§ØªÛŒ Ù¾ÛŒØ´</p>
            </div>
            <div class="w-detail space-y-4" id="newsFull"></div>
        </div>

    </div>

    <button onclick="openNotes()" class="fixed bottom-24 left-6 w-14 h-14 bg-yellow-500 hover:bg-yellow-400 text-black rounded-full shadow-2xl shadow-yellow-500/40 flex items-center justify-center z-30 transition-transform hover:scale-110 active:scale-95">
        <i class="fas fa-pen"></i>
    </button>

    <div id="notesModal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="glass-panel w-full max-w-sm p-6 bg-[#1e293b]">
            <h3 class="text-xl font-bold mb-4">ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ø´Ø®ØµÛŒ</h3>
            <textarea id="noteInput" class="w-full h-40 bg-black/20 rounded-xl p-4 text-white resize-none outline-none border border-white/10 focus:border-yellow-500 transition" placeholder="Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."></textarea>
            <div class="flex gap-2 mt-4">
                <button onclick="closeNotes()" class="flex-1 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-sm">Ø¨Ø³ØªÙ†</button>
                <button onclick="saveNote()" class="flex-1 py-3 rounded-xl bg-yellow-500 hover:bg-yellow-400 text-black font-bold text-sm">Ø°Ø®ÛŒØ±Ù‡</button>
            </div>
        </div>
    </div>

    <div class="fixed bottom-0 w-full h-[70px] glass-panel rounded-none border-t border-white/10 flex items-center justify-center z-30">
        <div class="text-center">
            <p class="text-[10px] text-gray-500 uppercase tracking-widest mb-1">Advertisement</p>
            <div class="w-[300px] h-[40px] bg-white/5 rounded flex items-center justify-center text-xs text-gray-600">
                Ù…Ø­Ù„ ØªØ¨Ù„ÛŒØºØ§Øª Ø´Ù…Ø§ (AdSense)
            </div>
        </div>
    </div>

    <script>
        // --- LOGIC ---

        document.addEventListener('DOMContentLoaded', () => {
            initDate();
            initPrayer();
            fetchRatesWithFallback(); // Ù…Ù†Ø·Ù‚ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù†Ø±Ø®
            initWeather();
            initHadith();
            loadNewsMock();
            
            // Drag & Drop
            Sortable.create(document.getElementById('grid'), {
                animation: 200,
                ghostClass: 'opacity-50',
                delay: 200,
                delayOnTouchOnly: true
            });
        });

        // --- 1. SMART CURRENCY FETCH ---
        async function fetchRatesWithFallback() {
            const elUsd = document.getElementById('usdPrice');
            const elList = document.getElementById('rateList');
            
            // Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ (Ø§Ú¯Ø± Ø§ÛŒÙ†ØªØ±Ù†Øª Ù†Ø¨ÙˆØ¯ ÛŒØ§ Ù¾Ø±ÙˆÚ©Ø³ÛŒ Ú©Ø§Ø± Ù†Ú©Ø±Ø¯)
            const fallbackRates = { USD: '71.20', EUR: '76.50', GBP: '89.10', IRR: '1.40', PKR: '0.25' };
            
            // Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù† Ø­Ø§Ù„Øª Ù„ÙˆØ¯ÛŒÙ†Ú¯
            elUsd.innerHTML = '<span class="skeleton">00.00</span>';

            try {
                // ØªÙ„Ø§Ø´ Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙØªÙ† Ø¯ÛŒØªØ§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø² Ù¾Ø±ÙˆÚ©Ø³ÛŒ
                const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent('https://sarafi.af/fa/exchange-rates/sarai-shahzada');
                
                // ØªØ§ÛŒÙ…â€ŒØ§ÙˆØª Ûµ Ø«Ø§Ù†ÛŒÙ‡â€ŒØ§ÛŒ (Ø§Ú¯Ø± Ø³Ø§ÛŒØª Ú©Ù†Ø¯ Ø¨ÙˆØ¯ØŒ Ù…Ø¹Ø·Ù„ Ù†Ø´ÙˆØ¯)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);
                
                const response = await fetch(proxyUrl, { signal: controller.signal });
                clearTimeout(timeoutId);
                
                const data = await response.json();
                
                if (data.contents) {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(data.contents, 'text/html');
                    const rows = doc.querySelectorAll('table tr');
                    
                    let rates = {};
                    rows.forEach(row => {
                        const txt = row.innerText;
                        if(txt.includes('Ø¯Ø§Ù„Ø±') && !rates.USD) rates.USD = parseRate(row);
                        if(txt.includes('ÛŒÙˆØ±Ùˆ')) rates.EUR = parseRate(row);
                        if(txt.includes('Ù¾ÙˆÙ†Ø¯')) rates.GBP = parseRate(row);
                    });
                    
                    // Ø§Ú¯Ø± Ø¯Ø§Ù„Ø± Ù¾ÛŒØ¯Ø§ Ø´Ø¯ØŒ Ø¢Ù¾Ø¯ÛŒØª Ú©Ù†. ÙˆÚ¯Ø±Ù†Ù‡ ÙØ§Ù„â€ŒØ¨Ú©
                    if (rates.USD && rates.USD !== '---') {
                        renderRates(rates);
                    } else {
                        throw new Error("Rate not found");
                    }
                }
            } catch (e) {
                console.log("Using Offline Data due to: " + e.message);
                renderRates(fallbackRates, true); // true = show offline badge
            }
        }

        function parseRate(row) {
            const cols = row.querySelectorAll('td');
            return cols.length > 2 ? cols[2].innerText.trim() : '---';
        }

        function renderRates(rates, isOffline = false) {
            document.getElementById('usdPrice').innerText = rates.USD;
            window.usdRate = parseFloat(rates.USD);
            
            let html = '';
            if(isOffline) html += `<div class="text-[10px] text-red-400 text-center mb-2">Ø§ØªØµØ§Ù„ Ø¨Ø±Ù‚Ø±Ø§Ø± Ù†Ø´Ø¯ - Ø¢Ø®Ø±ÛŒÙ† Ù†Ø±Ø®â€ŒÙ‡Ø§:</div>`;
            
            const flags = {USD: 'ğŸ‡ºğŸ‡¸', EUR: 'ğŸ‡ªğŸ‡º', GBP: 'ğŸ‡¬ğŸ‡§', IRR: 'ğŸ‡®ğŸ‡·', PKR: 'ğŸ‡µğŸ‡°'};
            for (const [key, val] of Object.entries(rates)) {
                if(!val) continue;
                html += `
                <div class="flex justify-between items-center bg-white/5 p-3 rounded-xl">
                    <span class="text-sm text-gray-300">${flags[key] || 'ğŸ³ï¸'} ${key}</span>
                    <span class="font-mono font-bold text-white">${val}</span>
                </div>`;
            }
            document.getElementById('rateList').innerHTML = html;
        }

        function convert() {
            const val = parseFloat(document.getElementById('convInput').value);
            const rate = window.usdRate || 71.20;
            if(!isNaN(val)) {
                document.getElementById('convRes').innerText = Math.round(val * rate).toLocaleString();
            }
        }

        // --- 2. PRAYER TIMES ---
        function initPrayer() {
            const coords = new adhan.Coordinates(34.5553, 69.2075);
            const params = adhan.CalculationMethod.Karachi();
            params.madhab = adhan.Madhab.Hanafi;
            const date = new Date();
            const times = new adhan.PrayerTimes(coords, date, params);
            
            const names = {fajr:'ØµØ¨Ø­', sunrise:'Ø·Ù„ÙˆØ¹', dhuhr:'Ù¾ÛŒØ´ÛŒÙ†', asr:'Ø¯ÛŒÚ¯Ø±', maghrib:'Ø´Ø§Ù…', isha:'Ø®ÙØªÙ†'};
            const list = document.getElementById('prayerFullList');
            let next = null;
            
            list.innerHTML = '';
            ['fajr', 'sunrise', 'dhuhr', 'asr', 'maghrib', 'isha'].forEach(p => {
                const t = times[p];
                const tStr = moment(t).format('HH:mm');
                list.innerHTML += `
                <div class="flex justify-between border-b border-white/5 pb-2">
                    <span class="text-gray-400">${names[p]}</span>
                    <span class="font-bold text-white font-mono">${tStr}</span>
                </div>`;
                
                if(!next && t > new Date()) next = {n: names[p], t: tStr};
            });

            if(next) {
                document.getElementById('nextPName').innerText = next.n;
                document.getElementById('nextPTime').innerText = next.t;
            } else {
                document.getElementById('nextPName').innerText = "ØµØ¨Ø­ (ÙØ±Ø¯Ø§)";
                // Logic for tomorrow fajr could be added here
            }
        }

        // --- 3. WEATHER ---
        async function initWeather() {
            try {
                const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=34.52&longitude=69.17&current_weather=true&daily=temperature_2m_max,temperature_2m_min&timezone=auto');
                const data = await res.json();
                document.getElementById('wTemp').innerText = Math.round(data.current_weather.temperature) + 'Â°';
                document.getElementById('wWind').innerText = data.current_weather.windspeed + ' km';
                document.getElementById('wHum').innerText = '45%'; 
                
                let forecastHtml = '';
                for(let i=1; i<=3; i++) {
                    forecastHtml += `
                    <div class="flex justify-between items-center text-sm bg-white/5 p-2 rounded-lg">
                        <span class="text-gray-400">${moment().add(i, 'days').format('jdddd')}</span>
                        <span class="font-mono text-white">${Math.round(data.daily.temperature_2m_max[i])}Â° / ${Math.round(data.daily.temperature_2m_min[i])}Â°</span>
                    </div>`;
                }
                document.getElementById('wForecast').innerHTML = forecastHtml;
            } catch(e){}
        }

        // --- 4. HADITH & NEWS ---
        function initHadith() {
            const h = [
                {ar: "Ù…ÙÙ†Ù’ ØµÙÙ…ÙØªÙ Ù†ÙØ¬ÙØ§", fa: "Ù‡Ø± Ú©Ù‡ Ø³Ú©ÙˆØª Ú©Ø±Ø¯ØŒ Ù†Ø¬Ø§Øª ÛŒØ§ÙØª."},
                {ar: "Ø§Ù„Ø¯ÙÙ‘Ù†Ù’ÛŒÙØ§ Ø³ÙØ¬Ù’Ù†Ù Ø§Ù„Ù’Ù…ÙØ¤Ù’Ù…ÙÙ†Ù", fa: "Ø¯Ù†ÛŒØ§ Ø²Ù†Ø¯Ø§Ù† Ù…ÙˆÙ…Ù† Ø§Ø³Øª."}
            ];
            const i = new Date().getDate() % h.length;
            document.getElementById('hAr').innerText = h[i].ar;
            document.getElementById('hFa').innerText = h[i].fa;
        }

        function loadNewsMock() {
            // Mock data to ensure UI looks good immediately
            const news = [
                {title: "Ú©Ø§Ù‡Ø´ Ûµ Ø¯Ø±ØµØ¯ÛŒ Ù‚ÛŒÙ…Øª ØªÛŒÙ„ Ø¯Ø± Ø¨Ø§Ø²Ø§Ø±", time: "Û± Ø³Ø§Ø¹Øª Ù¾ÛŒØ´"},
                {title: "Ø¢ØºØ§Ø² Ù¾Ø±ÙˆØ§Ø²Ù‡Ø§ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ú©Ø§Ø¨Ù„-Ø¯Ø¨ÛŒ", time: "Û³ Ø³Ø§Ø¹Øª Ù¾ÛŒØ´"},
                {title: "Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯Ù† ØªÛŒÙ… Ù…Ù„ÛŒ Ú©Ø±ÛŒÚ©Øª Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†", time: "Ûµ Ø³Ø§Ø¹Øª Ù¾ÛŒØ´"}
            ];
            document.getElementById('newsTitle').innerText = news[0].title;
            document.getElementById('newsTime').innerText = news[0].time;
            
            const list = document.getElementById('newsFull');
            news.forEach(n => {
                list.innerHTML += `
                <div class="flex gap-3 items-center border-b border-white/10 pb-3">
                    <div class="w-12 h-12 bg-white/10 rounded-lg flex-shrink-0"></div>
                    <div>
                        <h4 class="font-bold text-sm text-white leading-snug">${n.title}</h4>
                        <span class="text-[10px] text-gray-500">${n.time}</span>
                    </div>
                </div>`;
            });
        }

        // --- UTILS ---
        function initDate() {
            moment.loadPersian({usePersianDigits: true});
            document.getElementById('headerDate').innerText = moment().format('jD jMMMM jYYYY');
            document.getElementById('hijriDate').innerText = moment().format('jD jMMMM jYYYY | dddd');
        }

        // --- UI INTERACTION ---
        function expand(el) {
            // Prevent if clicking internal buttons
            if (event.target.closest('input') || event.target.closest('button')) return;
            
            // Add Expanded Class
            el.classList.add('expanded');
            document.getElementById('overlay').classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Stop scrolling bg
        }

        function closeAll() {
            document.querySelectorAll('.widget-item.expanded').forEach(el => el.classList.remove('expanded'));
            document.getElementById('overlay').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function openNotes() {
            document.getElementById('notesModal').classList.remove('hidden');
            document.getElementById('noteInput').value = localStorage.getItem('userNote') || '';
        }
        function closeNotes() {
            document.getElementById('notesModal').classList.add('hidden');
        }
        function saveNote() {
            localStorage.setItem('userNote', document.getElementById('noteInput').value);
            closeNotes();
        }
    </script>
</body>
</html>
