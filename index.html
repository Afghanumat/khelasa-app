<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>خلاصه | داشبورد هوشمند افغانستان</title>
    <meta name="theme-color" content="#1E3A8A">
    <link rel="manifest" href="manifest.json">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/adhan@4.0.0/App/Adhan.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment-jalaali@0.9.2/build/moment-jalaali.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;300;400;700;900&family=Scheherazade+New:wght@400;700&display=swap');
        
        body { font-family: 'Vazirmatn', sans-serif; background-color: #f3f4f6; overflow-x: hidden; user-select: none; -webkit-tap-highlight-color: transparent; }
        .font-arabic { font-family: 'Scheherazade New', serif; }
        
        /* Grid System */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 ستون برای موبایل */
            gap: 12px;
            padding: 12px;
            padding-bottom: 80px; /* فضای تبلیغ */
            max-width: 800px;
            margin: 0 auto;
        }

        /* Widget Card */
        .widget {
            background: white;
            border-radius: 20px;
            padding: 12px;
            height: 130px; /* ارتفاع فشرده */
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            z-index: 1;
        }

        .widget:active { transform: scale(0.98); }

        /* Expanded State */
        .widget.expanded {
            grid-column: span 2;
            grid-row: span 2;
            height: 350px;
            z-index: 50;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border: 2px solid #1E3A8A;
        }

        /* Content Visibility */
        .widget-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .widget-preview { transition: opacity 0.2s; }
        .widget.expanded .widget-preview { opacity: 0.5; transform: scale(0.95); }
        
        .widget-full {
            opacity: 0;
            max-height: 0;
            margin-top: 0;
            overflow-y: auto;
            transition: all 0.4s ease;
            pointer-events: none;
        }
        
        .widget.expanded .widget-full {
            opacity: 1;
            max-height: 100%;
            margin-top: 15px;
            pointer-events: auto;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }

        /* Icons */
        .icon-box { width: 36px; height: 36px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; }
        
        /* Dark Mode */
        @media (prefers-color-scheme: dark) {
            body { background-color: #111827; color: #f3f4f6; }
            .widget { background-color: #1f2937; color: white; box-shadow: none; border: 1px solid #374151; }
            .widget.expanded { border-color: #60a5fa; background-color: #1f2937; }
        }

        /* Desktop */
        @media (min-width: 768px) {
            .dashboard-grid { grid-template-columns: repeat(4, 1fr); }
            .widget.expanded { grid-column: span 2; grid-row: span 2; }
        }
    </style>
</head>
<body>

    <header class="sticky top-0 z-40 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b dark:border-slate-800 px-4 py-3 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white"><i class="fas fa-layer-group"></i></div>
            <div>
                <h1 class="font-black text-lg text-blue-900 dark:text-blue-400 leading-none">خلاصه</h1>
                <span class="text-[10px] text-gray-500" id="currentDate">در حال بارگذاری...</span>
            </div>
        </div>
        <div class="relative">
            <input type="text" id="quickSearch" placeholder="جستجو..." class="bg-gray-100 dark:bg-slate-800 px-3 py-1.5 rounded-full text-sm w-32 focus:w-48 transition-all outline-none border border-transparent focus:border-blue-500">
            <i class="fas fa-search absolute left-3 top-2 text-gray-400 text-xs"></i>
        </div>
    </header>

    <div id="grid-container" class="dashboard-grid">

        <div class="widget" id="w-currency">
            <div class="widget-header">
                <div class="icon-box bg-green-100 text-green-600 dark:bg-green-900 dark:text-green-300"><i class="fas fa-money-bill-wave"></i></div>
                <div class="text-[10px] bg-green-500 text-white px-2 py-0.5 rounded-full animate-pulse">زنده</div>
            </div>
            <div class="mt-auto widget-preview">
                <p class="text-xs text-gray-500">دالر به افغانی</p>
                <div class="flex items-end gap-2">
                    <span class="text-2xl font-black text-slate-800 dark:text-white" id="usd-rate">...</span>
                    <i class="fas fa-chevron-up text-xs mb-1.5 text-gray-400"></i>
                </div>
            </div>
            <div class="widget-full">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold text-sm">نرخ لحظه‌ای (سرای شهزاده)</h3>
                    <button onclick="fetchRates()" class="text-blue-500 text-xs"><i class="fas fa-sync"></i></button>
                </div>
                <div class="space-y-2 text-sm" id="rates-list">
                    <div class="text-center text-gray-400 text-xs mt-4">در حال دریافت از sarafi.af...</div>
                </div>
                <div class="mt-4 pt-3 border-t dark:border-slate-700">
                    <div class="flex gap-2">
                        <input type="number" id="convAmount" class="w-full bg-gray-100 dark:bg-slate-800 p-2 rounded text-center" placeholder="مقدار USD" oninput="convertCurrency()">
                        <div class="flex items-center text-xs text-gray-500">= <span id="convResult" class="font-bold text-blue-600 mx-1">0</span> AFN</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="widget" id="w-prayer">
            <div class="widget-header">
                <div class="icon-box bg-indigo-100 text-indigo-600 dark:bg-indigo-900 dark:text-indigo-300"><i class="fas fa-mosque"></i></div>
                <span class="text-[10px] text-gray-400">کابل</span>
            </div>
            <div class="mt-auto widget-preview">
                <p class="text-xs text-gray-500">نماز بعدی: <span id="next-p-name">...</span></p>
                <span class="text-2xl font-black text-slate-800 dark:text-white" id="next-p-time">--:--</span>
            </div>
            <div class="widget-full">
                <h3 class="font-bold text-sm mb-2 text-center text-indigo-500">اوقات شرعی امروز</h3>
                <ul class="space-y-2 text-sm" id="prayer-list"></ul>
                <p class="text-[10px] text-center mt-2 text-gray-400">محاسبه: دانشگاه علوم اسلامی (حنفی)</p>
            </div>
        </div>

        <div class="widget" id="w-weather">
            <div class="widget-header">
                <div class="icon-box bg-sky-100 text-sky-600 dark:bg-sky-900 dark:text-sky-300"><i class="fas fa-cloud-sun"></i></div>
            </div>
            <div class="mt-auto widget-preview flex justify-between items-end">
                <div>
                    <p class="text-xs text-gray-500" id="weather-desc">صاف</p>
                    <span class="text-2xl font-black text-slate-800 dark:text-white" id="weather-temp">--°</span>
                </div>
                <i class="fas fa-sun text-yellow-500 text-2xl"></i>
            </div>
            <div class="widget-full">
                <div class="flex justify-around text-center mb-4">
                    <div><i class="fas fa-wind text-gray-400 block mb-1"></i><span id="w-wind" class="text-xs font-bold">--</span></div>
                    <div><i class="fas fa-tint text-gray-400 block mb-1"></i><span id="w-hum" class="text-xs font-bold">--</span></div>
                </div>
                <div class="space-y-1" id="forecast-list"></div>
            </div>
        </div>

        <div class="widget" id="w-hadith" style="background: linear-gradient(135deg, #4f46e5 0%, #3b82f6 100%); color: white; border:none;">
            <div class="widget-header">
                <div class="icon-box bg-white/20 text-white"><i class="fas fa-book-open"></i></div>
            </div>
            <div class="mt-auto widget-preview">
                <p class="text-xs text-blue-100">حدیث روز</p>
                <p class="text-sm font-bold truncate">قال رسول الله (ص)...</p>
            </div>
            <div class="widget-full text-center">
                <p class="font-arabic text-lg mb-2" id="hadith-ar">...</p>
                <p class="text-sm bg-white/10 p-2 rounded leading-relaxed" id="hadith-fa">...</p>
                <button onclick="loadHadith()" class="mt-3 text-xs bg-white/20 px-3 py-1 rounded hover:bg-white/30">حدیث بعدی</button>
            </div>
        </div>

        <div class="widget" id="w-news">
            <div class="widget-header">
                <div class="icon-box bg-red-100 text-red-600 dark:bg-red-900 dark:text-red-300"><i class="fas fa-newspaper"></i></div>
            </div>
            <div class="mt-auto widget-preview">
                <p class="text-xs text-gray-500">اخبار افغانستان</p>
                <span class="text-sm font-bold truncate block" id="news-title">در حال دریافت...</span>
            </div>
            <div class="widget-full space-y-3" id="news-list">
                </div>
        </div>

        <div class="widget" id="w-notes">
            <div class="widget-header">
                <div class="icon-box bg-yellow-100 text-yellow-600 dark:bg-yellow-900 dark:text-yellow-300"><i class="fas fa-sticky-note"></i></div>
            </div>
            <div class="mt-auto widget-preview">
                <p class="text-xs text-gray-500">یادداشت سریع</p>
                <span class="text-sm font-bold" id="note-preview">خالی</span>
            </div>
            <div class="widget-full">
                <textarea id="user-note" class="w-full h-24 bg-gray-50 dark:bg-slate-800 p-2 rounded text-sm resize-none outline-none focus:ring-1 ring-yellow-500" placeholder="بنویسید..."></textarea>
                <button onclick="saveNote()" class="w-full mt-2 bg-yellow-500 text-white text-xs py-2 rounded font-bold">ذخیره</button>
            </div>
        </div>

    </div>

    <div class="fixed bottom-0 w-full h-[60px] bg-white dark:bg-slate-900 border-t dark:border-slate-800 flex items-center justify-center z-50 shadow-[0_-5px_15px_rgba(0,0,0,0.05)]">
        <span class="text-xs text-gray-400" id="ad-slot">تبلیغات گوگل (AdSense)</span>
    </div>

    <script src="app.js"></script>
</body>
</html>